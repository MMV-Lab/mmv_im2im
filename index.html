<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to MMV Im2Im Transformation’s documentation! &mdash; MMV Im2Im Transformation 0.1.3 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> MMV Im2Im Transformation
          </a>
              <div class="version">
                0.1.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#stable-release">Stable release</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#from-sources">From sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Package modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mmv_im2im.html">mmv_im2im package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mmv_im2im.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mmv_im2im.bin.html">mmv_im2im.bin package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mmv_im2im.data_modules.html">mmv_im2im.data_modules package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mmv_im2im.models.html">mmv_im2im.models package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mmv_im2im.postprocessing.html">mmv_im2im.postprocessing package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mmv_im2im.preprocessing.html">mmv_im2im.preprocessing package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mmv_im2im.utils.html">mmv_im2im.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mmv_im2im.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmv_im2im.html#module-mmv_im2im.proj_tester">mmv_im2im.proj_tester module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmv_im2im.html#module-mmv_im2im.proj_trainer">mmv_im2im.proj_trainer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmv_im2im.html#module-mmv_im2im">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#deploying">Deploying</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">MMV Im2Im Transformation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>Welcome to MMV Im2Im Transformation’s documentation!</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="welcome-to-mmv-im2im-transformation-s-documentation">
<h1>Welcome to MMV Im2Im Transformation’s documentation!<a class="headerlink" href="#welcome-to-mmv-im2im-transformation-s-documentation" title="Permalink to this heading"></a></h1>
<div class="toctree-wrapper compound">
</div>
</section>
<section id="mmv-im2im-transformation">
<h1>MMV Im2Im Transformation<a class="headerlink" href="#mmv-im2im-transformation" title="Permalink to this heading"></a></h1>
<a class="reference external image-reference" href="https://github.com/MMV-Lab/mmv_im2im/actions"><img alt="Build Status" src="https://github.com/MMV-Lab/mmv_im2im/workflows/Build%20Main/badge.svg" /></a>
<a class="reference external image-reference" href="https://MMV-Lab.github.io/mmv_im2im/"><img alt="Documentation" src="https://github.com/MMV-Lab/mmv_im2im/workflows/Documentation/badge.svg" /></a>
<a class="reference external image-reference" href="https://codecov.io/gh/MMV-Lab/mmv_im2im"><img alt="Code Coverage" src="https://codecov.io/gh/MMV-Lab/mmv_im2im/branch/main/graph/badge.svg" /></a>
<p>A python package for deep learing based image to image transformation in biomedical applications</p>
<hr class="docutils" />
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p><strong>Stable Release:</strong> <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">mmv_im2im</span></code><span class="raw-html-m2r"><br></span>
<strong>Development Head:</strong> <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">git+https://github.com/MMV-Lab/mmv_im2im.git</span></code></p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading"></a></h2>
<p>For full package documentation please visit <a class="reference external" href="https://MMV-Lab.github.io/mmv_im2im">MMV-Lab.github.io/mmv_im2im</a>.</p>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this heading"></a></h2>
<p>Here, we use a <a class="reference external" href="https://www.allencell.org/label-free-determination.html#:~:text=The%20Label-Free%20Determination%20model%20can%20leverage%20the%20specificity,structures.%20How%20does%20the%20label-free%20determination%20model%20work%3F">3D labelfree determination</a> as a test case.</p>
<p>First, we pull 100 examples from the AllenCell quilt bucket by running the following. Make sure you change the <code class="docutils literal notranslate"><span class="pre">parent_path</span></code> before running.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python  scripts/generate_synthetic_data.py
</pre></div>
</div>
<p>Then, we can train a labelfree model like this:</p>
<div class="highlight-base notranslate"><div class="highlight"><pre><span></span>run_im2im --config train_labelfree_3d  --data.data_path /path/to/your/dataset
</pre></div>
</div>
<p>This will apply all the default settings on your data to train the 3D labelfree model.</p>
</section>
<section id="notes-on-the-package-design">
<h2>Notes on the package design<a class="headerlink" href="#notes-on-the-package-design" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p>The four main packages we build upon: <a class="reference external" href="https://www.pytorchlightning.ai/">pytorch-lightning</a>, <a class="reference external" href="https://monai.io/">MONAI</a>, <a class="reference external" href="https://eladrich.github.io/pyrallis/">pyrallis</a>, and <a class="reference external" href="https://github.com/AllenCellModeling/aicsimageio">aicsimageio</a>.</p></li>
</ol>
<p>The whole package uses <a class="reference external" href="https://www.pytorchlightning.ai/">pytorch-lightning</a> as the core of its backend, in the sense that the package is implemented following the biolerplate components in pytorch-lightning, such as <code class="docutils literal notranslate"><span class="pre">LightningModule</span></code>, <code class="docutils literal notranslate"><span class="pre">DataModule</span></code> and <code class="docutils literal notranslate"><span class="pre">Trainer</span></code>. All small building blocks, like network architecture, optimizer, etc., can be swapped easily without changing the boilerplate.</p>
<p>We adopt the <a class="reference external" href="https://docs.monai.io/en/stable/data.html#persistentdataset">PersistentDataset</a> in <a class="reference external" href="https://monai.io">MONAI</a> as the default dataloader, which combines the efficiency and flexibility in data handling for biomedical applications. E.g., able to efficiently handle: when any single file in training data is large, sampling mutiple patches from each of the large image in training data, and when there are a huge number of files and have to load a small portion to memory in each epoch and periodically refresh the data in memory, etc.</p>
<p><a class="reference external" href="https://eladrich.github.io/pyrallis/">Pyrallis</a> provides a handy configuration system. Combining pyrallis and the boilerplate concepts in pytorch-lightning, it is very easy to configurate your method at any level of details (as high level as only providing the path to the training data, all the way to as low level as changing which type of normalization to use in the model).</p>
<p>Finally, <a class="reference external" href="https://github.com/AllenCellModeling/aicsimageio">aicsimageio</a> is adopted for efficient data I/O, which not only supports all major bio-formats and OME-TIFF, but also makes it painless to handle hugh data by delayed loading.</p>
<ol class="arabic simple">
<li><p>There are three levels of abstraction:</p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mmv_im2im/proj_trainer.py</span></code> (main entry point to define data module, pytorch-lightning module, and trainer)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mmv_im2im/data_modules/data_loaders.py</span></code> (Currently, all 2D/3D paired/unpaired data loader can share the same universal dataloader. We may add other generic dataloaders when really needed, otherwise, the current one is general enough to cover current applications)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mmv_im2im/models/pl_XYZ.py</span></code> (the middle level wrapper for different categories of models: FCN, pix2pix (conditional GAN), CycleGAN, embedseg. We can add more when needed, e.g., for denoising or cellpose. This is the pytorch-lightning module specific for this category of models. The specific model backbone, loss function, etc. can be easily specified via parameters in yaml config)</p>
<ul>
<li><p>Other scripts under <code class="docutils literal notranslate"><span class="pre">mmv_im2im/models/nets/</span></code> and <code class="docutils literal notranslate"><span class="pre">mmv_im2im/preprocessing</span></code>, as well as <code class="docutils literal notranslate"><span class="pre">mmv_im2im/utils</span></code>, are low level functions to instantiate the pytorch-lightining module defined in <code class="docutils literal notranslate"><span class="pre">pl_XYZ.py</span></code> or <code class="docutils literal notranslate"><span class="pre">data_loader.py</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol class="arabic simple">
<li><p>Understand the configuration system and make customizations</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--help</span></code> can print out all the configuration details, including their default values. We pre-compiled a collection of configuration for various tasks, see <code class="docutils literal notranslate"><span class="pre">/mmv_im2im/configs/preset_XXYYZZ.yaml</span></code>. To use a preset configuration, one can simply do <code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--config</span> <span class="pre">XXYYZZ</span></code> Or, you can run on your customized configuration file <code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--config</span> <span class="pre">/full/path/to/your/config.yaml</span></code>. You can specify everything in the yaml file, or you can also pass in additional args via the command line. For example, we have a general configuration file at <code class="docutils literal notranslate"><span class="pre">/home/example/my_config.yaml</span></code>, which specific the model details and training details for one specific project. But, when you train different models for this same project with different data, you don’t have to change the yaml file. Instead, you can simply pass in the extra data path in command line, like <code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--config</span> <span class="pre">/home/example/my_config.yaml</span> <span class="pre">--data.data_path</span> <span class="pre">/path/to/my/data</span></code>. So, it is a good practice to make different generic configurations for different projects, and leave the runtime specific args, like data_path, to the command line.</p>
<p>A special note on dictionary parameters. After printing out all the details from <code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--help</span></code>, if you see one parameter is a Dict, for example <code class="docutils literal notranslate"><span class="pre">training.params</span></code>, you need to be careful if you want to overwrite the values specified in yaml by values passed in command line. Specifically, you have to overwrite the whole dictionary, and cannot overwrite only a specific key. In this situation, I would recommed to change the config file directly, instead of overwriting with command line args.</p>
<ol class="arabic simple">
<li><p>About the training data directory</p></li>
</ol>
<p>Currently, the package supports three types of training data organizations. First, one single folder with “X1_IM.tiff”, “X1_GT.tiff”, “X1_CM.tiff”, “X2_IM.tiff”, etc.. Second, one single folder with multiple sub-folders “IM”, “GT”, “CM” (optional), where the name of each file is exactly the same accross different subfolders. The first two scenario will incur a train/validatio split on all files. If you already have train/validation split done, then you can pass in the something like <code class="docutils literal notranslate"><span class="pre">--data.data_path</span> <span class="pre">&quot;{'train':</span> <span class="pre">'/path/to/train',</span> <span class="pre">'val':</span> <span class="pre">'/path/to/val'}&quot;</span></code>, where <code class="docutils literal notranslate"><span class="pre">/path/to/train</span></code> and <code class="docutils literal notranslate"><span class="pre">/path/to/val</span></code> are similar to the first scenario above.</p>
<p><strong>preset keys</strong>: “IM” (raw images), “GT” (ground truth or training target), “CM” (costmap, e.g. to exclude certain pixels by setting corresponding value in costmap as 0)</p>
<p><strong>Additional note for EmbedSeg</strong>: When doing <code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--config</span> <span class="pre">train_embedseg_3d</span> <span class="pre">--data.data_path</span> <span class="pre">/path/to/train</span></code>, we expect “IM” and “GT” in the folder <code class="docutils literal notranslate"><span class="pre">/path/to/train</span></code> (“CM” is optional). However, the program will automatically convert this dataset into a special format needed for EmbedSeg and save them at the folder specified by <code class="docutils literal notranslate"><span class="pre">data.cache_path</span></code> (default is <code class="docutils literal notranslate"><span class="pre">./tmp</span></code>). Two new types of files wil be created in the cache_path, including “CL” (CLass image) and “CE” (CEnter image). Since preparing this compatible dataset takes time, one can directly specify the cache_path to load without re-generating from original training data. Namely <code class="docutils literal notranslate"><span class="pre">run_im2im</span> <span class="pre">--config</span> <span class="pre">train_embegseg_3d</span> <span class="pre">--data.cache_path</span> <span class="pre">./tmp/</span></code> even without passing the <code class="docutils literal notranslate"><span class="pre">data.data_path</span></code>.</p>
</section>
<section id="development">
<h2>Development<a class="headerlink" href="#development" title="Permalink to this heading"></a></h2>
<p>See <a class="reference external" href="CONTRIBUTING.md">CONTRIBUTING.md</a> for information related to developing the code.</p>
<p><strong>MIT license</strong></p>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Jianxu Chen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>